#!/bin/bash

OS=$(uname)

if [ "$OS" != "Linux" ]; then
    echo "This script must be run on Linux."
    exit 1
fi

echo "--- Building Docker image ---"
sudo docker build -t engine "$DIR"
echo "--- Docker build finished ---"

xhost +SI:localuser:root

sudo docker run --rm --net=host \
    -e DISPLAY="$DISPLAY" \
    -e XAUTHORITY=/root/.Xauthority \
    -e LD_LIBRARY_PATH=/app/libs \
    -e QT_PLUGIN_PATH=/app/plugins \
    -e QT_QPA_PLATFORM_PLUGIN_PATH=/app/plugins/platforms \
    -e QT_DEBUG_PLUGINS=1 \
    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \
    -v "$HOME/.Xauthority":/root/.Xauthority:ro \
    -v /run/user/$(id -u)/bus:/run/user/$(id -u)/bus \
    -e DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u)/bus \
    -v "$HOME/.cache/spatialshot/tmp":/root/.cache/spatialshot/tmp \
    engine ./engine

xhost -SI:localuser:root
exit 0